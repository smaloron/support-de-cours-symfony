<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2025-02-01T08:49:35.066754"><title>La classe Repository | Symfony support</title><script type="application/json" id="virtual-toc-data">[{"id":"objectifs","level":0,"title":"Objectifs","anchor":"#objectifs"},{"id":"principes","level":0,"title":"Principes","anchor":"#principes"},{"id":"les-m-thodes-de-serviceentityrepository","level":0,"title":"Les méthodes de ServiceEntityRepository","anchor":"#les-m-thodes-de-serviceentityrepository"},{"id":"les-limites-de-ces-m-thodes-simples","level":0,"title":"Les limites de ces méthodes simples","anchor":"#les-limites-de-ces-m-thodes-simples"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b575/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="La classe Repository | Symfony support"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Symfony support Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation//version 1/004-04-la-classe-repository.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="La classe Repository | Symfony support"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation//version 1/004-04-la-classe-repository.html#webpage",
    "url": "writerside-documentation//version 1/004-04-la-classe-repository.html",
    "name": "La classe Repository | Symfony support",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Symfony support Help"
}</script><!-- End Schema.org --></head><body data-id="004-04-La-classe-Repository" data-main-title="La classe Repository" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="004-00-doctrine.md|Doctrine"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Symfony support version 1 Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="004-04-La-classe-Repository" id="004-04-La-classe-Repository.md">La classe Repository</h1><section class="chapter"><h2 id="objectifs" data-toc="objectifs">Objectifs</h2><ul class="list _bullet" id="val49t_7"><li class="list__item" id="val49t_8"><p>Identifier le r&ocirc;le de la classe <code class="code" id="val49t_10">Repository</code>.</p></li><li class="list__item" id="val49t_9"><p>Utiliser les m&eacute;thodes de <code class="code" id="val49t_11">ServiceEntityRepository</code> pour effectuer des requ&ecirc;tes simples.</p></li></ul></section><section class="chapter"><h2 id="principes" data-toc="principes">Principes</h2><p id="val49t_12">Chaque entit&eacute; peut &ecirc;tre li&eacute;e &agrave; une classe <code class="code" id="val49t_14">Repository</code> qui h&eacute;rite de <code class="code" id="val49t_15">ServiceEntityRepository</code>. Cette classe centralise les requ&ecirc;tes personnalis&eacute;es sur cette entit&eacute;.</p><p id="val49t_13"><code class="code" id="val49t_16">ServiceEntityRepository</code> fournit un ensemble de m&eacute;thodes qui couvrent les besoins standards.</p></section><section class="chapter"><h2 id="les-m-thodes-de-serviceentityrepository" data-toc="les-m-thodes-de-serviceentityrepository">Les m&eacute;thodes de <code class="code" id="val49t_22">ServiceEntityRepository</code></h2><section class="chapter"><h3 id="obtenir-toutes-les-entit-s" data-toc="obtenir-toutes-les-entit-s">Obtenir toutes les entit&eacute;s</h3><p id="val49t_23">La m&eacute;thode <code class="code" id="val49t_31">findAll</code> permet d'obtenir un tableau ordinal de toutes les entit&eacute;s persist&eacute;es en base de donn&eacute;es. Cette m&eacute;thode tr&egrave;s simple, n'admet aucun argument.</p><p id="val49t_24">Si l'entit&eacute; poss&egrave;de des associations, il sera possible d'obtenir &eacute;galement les donn&eacute;es des entit&eacute;s li&eacute;es.</p><p id="val49t_25"><span class="control" id="val49t_32">Le contr&ocirc;leur</span></p><div class="code-block" data-lang="php">
final class ArticleController extends AbstractController
{
    #[Route('/article', name: 'app_article')]
    public function index(ArticleRepository $repository): Response
    {
        $articles = $repository-&gt;findAll();
        
        return $this-&gt;render(
            'article/index.html.twig', 
            ['article-list' =&gt; $articles,]
        );
    }
}
</div><p id="val49t_27"><span class="control" id="val49t_33">La vue</span></p><div class="code-block" data-lang="twig">
{% extends 'base.html.twig' %}

{% block title %}Liste des articles{% endblock %}

{% block body %}
    
    &lt;h1&gt;Liste des articles&lt;/h1&gt;
    &lt;table&gt;
        &lt;thead&gt;
            &lt;tr&gt;
                &lt;th&gt;Titre&lt;/th&gt;
                &lt;th&gt;Catégorie&lt;/th&gt;
            &lt;/tr&gt;
        &lt;/thead&gt;
        &lt;tbody&gt;
            {% for article in articleList %}
                &lt;tr&gt;
                    &lt;td&gt;{{ article.title }}&lt;/td&gt;
                    &lt;td&gt;{{ article.category.categoryName }}&lt;/td&gt;
                &lt;/tr&gt;
            {% endfor %}
        &lt;/tbody&gt;
    &lt;/table&gt;
    
{% endblock %}
</div><p id="val49t_29">Nous constatons dans le profiler que Doctrine a effectu&eacute; une requ&ecirc;te pour r&eacute;cup&eacute;rer les articles et autant de requ&ecirc;tes qu'il y avait deux cat&eacute;gories &agrave; r&eacute;cup&eacute;rer.</p><figure id="val49t_30"><img alt="CleanShot 2025-01-23 at 08.14.31@2x.png" src="images/CleanShot%202025-01-23%20at%2008.14.31%402x.png" title="CleanShot 2025-01-23 at 08.14.31@2x.png" width="2158" height="2720"></figure></section><section class="chapter"><h3 id="obtenir-une-seule-entit" data-toc="obtenir-une-seule-entit">Obtenir une seule entit&eacute;</h3><p id="val49t_34">Pour obtenir une seule entit&eacute; en fonction de son identifiant, nous avons la m&eacute;thode <code class="code" id="val49t_42">find</code> qui admet en argument l'id recherch&eacute;e.</p><aside class="prompt" data-type="tip" data-title="" id="val49t_35"><p id="val49t_43">bien entendu. Dans cet exemple, il y a une solution plus simple que nous connaissons d&eacute;j&agrave; et qui consiste &agrave; passer l'entit&eacute; en argument de la m&eacute;thode du contr&ocirc;leur. Gr&acirc;ce aux composants <code class="code" id="val49t_44">ParamConverter</code> Symfony sera capable de r&eacute;cup&eacute;rer l'entit&eacute; &agrave; partir de l'id pass&eacute; dans la route.</p></aside><p id="val49t_36"><span class="control" id="val49t_45">Le contr&ocirc;leur</span></p><div class="code-block" data-lang="php">
#[Route('/article/{id}', name: 'app_article_details')]
    public function show(
        ArticleRepository $repository,
        int $id): Response
    {
        $article = $repository-&gt;find($id);

        return $this-&gt;render(
            'article/details.html.twig',
            ['article' =&gt; $article,]
        );
    }
</div><p id="val49t_38"><span class="control" id="val49t_46">La vue</span></p><div class="code-block" data-lang="twig">
{% extends 'base.html.twig' %}

{% block title %}Détails d'un article{% endblock %}

{% block body %}

    &lt;h1&gt;Détails d'un article&lt;/h1&gt;

    {{ dump(article) }}

{% endblock %}
</div><p id="val49t_40"><span class="control" id="val49t_47">Un lien sur la vue index</span></p><div class="code-block" data-lang="twig">
{% extends 'base.html.twig' %}

{% block title %}Liste des articles{% endblock %}

{% block body %}

    &lt;h1&gt;Liste des articles&lt;/h1&gt;
    &lt;table&gt;
        &lt;thead&gt;
            &lt;tr&gt;
                &lt;th&gt;Titre&lt;/th&gt;
                &lt;th&gt;Catégorie&lt;/th&gt;
            &lt;/tr&gt;
        &lt;/thead&gt;
        &lt;tbody&gt;
            {% for article in articleList %}
                &lt;tr&gt;
                    &lt;td&gt;
                        &lt;a href=&quot;{{ path('article_show', {'id': article.id}) }}&quot;&gt;
                            {{ article.title }}
                        &lt;/a&gt;
                    &lt;/td&gt;
                    &lt;td&gt;{{ article.category.categoryName }}&lt;/td&gt;
                &lt;/tr&gt;
            {% endfor %}
        &lt;/tbody&gt;
    &lt;/table&gt;

{% endblock %}
</div></section><section class="chapter"><h3 id="recherche-sur-crit-res" data-toc="recherche-sur-crit-res">Recherche sur crit&egrave;res</h3><p id="val49t_48">Pour rechercher des entit&eacute;s selon un crit&egrave;re, nous disposons de deux m&eacute;thodes <code class="code" id="val49t_50">findBy</code> et <code class="code" id="val49t_51">findOneBy</code>. La premi&egrave;re retourne un tableau d'entit&eacute;. La seconde ne retourne qu'une seule entit&eacute;. Ces deux m&eacute;thodes admettent en argument, un tableau associatif, repr&eacute;sentant les crit&egrave;res et un second tableau facultatif repr&eacute;sentant la clause <code class="code" id="val49t_52">ORDER BY</code>.</p><div class="code-block" data-lang="php">
#[Route('/article-by-category/{categoryId}', 
        name: 'app_article_search_by_category')]
    public function searchByCategory(
        ArticleRepository $repository,
        int $categoryId
    ): Response
    {
        $articles = $repository-&gt;findBy(
            ['category' =&gt; $categoryId],
            ['title' =&gt; 'DESC']
        );

        return $this-&gt;render(
            'article/index.html.twig',
            ['articleList' =&gt; $articles,]
        );
    }
</div></section><section class="chapter"><h3 id="exercice" data-toc="exercice">Exercice</h3><ul class="list _bullet" id="val49t_53"><li class="list__item" id="val49t_54"><p>Dans le contr&ocirc;leur <code class="code" id="val49t_57">index</code> r&eacute;cup&eacute;rer l'ensemble des cat&eacute;gories et les passer &agrave; la vue</p></li><li class="list__item" id="val49t_55"><p>Dans la vue <code class="code" id="val49t_58">index</code>, afficher toutes les cat&eacute;gories et faites un lien vers la route <code class="code" id="val49t_59">app_article_search_by_category</code></p></li><li class="list__item" id="val49t_56"><p>Afficher le nombre d'articles en face de chaque cat&eacute;gorie</p></li></ul></section></section><section class="chapter"><h2 id="les-limites-de-ces-m-thodes-simples" data-toc="les-limites-de-ces-m-thodes-simples">Les limites de ces m&eacute;thodes simples</h2><p id="val49t_60">On ne peut requ&ecirc;ter que sur les informations de l'entit&eacute; principale. Dans notre exemple, on ne peut directement requ&ecirc;ter sur <code class="code" id="val49t_62">category.categoryName</code>.</p><p id="val49t_61">Pour aller plus loin, il nous faudra utiliser la classe <code class="code" id="val49t_63">QueryBuilder</code> qui est int&eacute;gr&eacute;e au <code class="code" id="val49t_64">repository</code> des entit&eacute;s.</p></section><div class="last-modified">Last modified: 01 février 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="004-01-fixtures.html" class="navigation-links__prev">Les fixtures</a><a href="004-05-le-cycle-de-vie-des-entites.html" class="navigation-links__next">Le cycle de vie des entit&eacute;s</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b575/app.js"></script></body></html>